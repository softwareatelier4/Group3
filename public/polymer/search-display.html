<link rel="import" href="./components/polymer/polymer.html">
<link rel="stylesheet" type="text/css"
    href="https://fonts.googleapis.com/css?family=Didact+Gothic">
<!--
This is the polymer component for the search field.
-->

<dom-module id="search-display">
  <template>
    <style>
    :root{
    --main-color:#494E6B;
    --main-color-lighter:#5d6389;
    --second-color:#98878F;
    --third-color:#985E6D;
    --fourth-color:#192231;
  }
      :host {

        display: flex;
        background-color: white;
        padding-left: 20%;
        flex-direction: column;
        align-items: stretch;
        width: 90%;
      }
      .profile-container{
        width:100%;
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        background-color: white;
        min-width:22em;
        margin-top: 15%;
      }
      .freelancer-container{
        background: rgb(242, 242, 242);
        padding: 1vh;
        margin: 1vh;
        width: 40%;
        min-width:50%;
        flex-grow: 1;
        font-family: Didact Gothic;
        border-left-style: solid;
        border-width: 2px;
        /*border-color: var(--third-color);*/
      }
      .element-display{
        padding-left: 150px;
      }
      .element-display-right{
        text-align: right;
        font-weight: bold;
        font-size: 18px;
        letter-spacing: 1px;

      }
      img {
        height: 120px;
        width: 120px;
        vertical-align: middle;
        object-fit: cover;
        float: left;
        padding-top: 10px;
      }
      h2{
        font-family: Didact Gothic;
        margin: 1vh;
      }
      .button {
        background-color: var(--main-color);
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        float: right;
        text-transform: uppercase;
      }

      .button2{
         border: none;
         color: white;
         text-align: center;
         text-decoration: none;
         display: block;


      }
  
      #spacer {
        height:10%;
      }
      .button:hover{
        background-color: var(--main-color-lighter);
      }
      img:hover{
        background-color: rgb(230, 230, 230);
      }
    </style>

    <!-- <h2> Search Results:</h2> -->
    <div id="spacer"></div>
    <div class= "profile-container">
      <template is="dom-repeat" items="{{searchData}}" sort="_sort">
        <!-- <a href="/profile/{{item._id}}"> -->
        <div  class="freelancer-container">
          <img src ="../img/profile_pic.png">
          <div class= "element-display-right"><span>{{distance(item.latitude, item.longitude)}} away</span></div>
          <div class="element-display"><star-rating rating='4'></star-rating></div>
          <div class="element-display">First Name: <span>{{item.firstName}}</span></div>
          <div class= "element-display">Last Name: <span>{{item.lastName}}</span></div>
          <div class= "element-display">Location: <span>{{item.location}}</span></div>
          <div class= "element-display">Email: <span>{{item.email}}</span></div>
          <div class= "element-display">Job: <span>{{item.job}}</span></div>
          <div class= "element-display">Tel: <span>{{item.telephoneNum}}</span></div>
          <!--<div class= "element-display">Distance: <span>{{distance(item.latitude, item.longitude)}}</span></div>-->
          <p></p>
          <center>
              <paper-button class = "button"> 
                  <a href = "/profile/{{item._id}}" class = "button2"> Visit profile </a>
              </paper-button>
         </center>
          <!-- <div class= "element-display">Review: <span>{{item.Review}}</span></div> -->
          <!-- <div class= "element-display">Member since: <span>{{item.CreationDate}}</span></div> -->

        </div>
      </template>
  </div>
  </template>

  <script>
    Polymer({

      is: 'search-display',
      ready: function() {
//          this.distance(45.4612, 9.1878);
      },

      properties: {
        prop1: {
          type: String,
          value: 'temp'
        },
        searchData:{
          type:Object,
          value:[]
        }
      },
      handleTap:function(e){
        console.log(e)
      },

      distance : function (lat2, lon2) {
          var R = 6371e3; // km
          // temporary we put location
          var lat1 = 46.0058;
          var lon1 = 8.9475;
//          var lat2 = 45.4612;
//          var lon2 = 9.1878;
          var distLat = this.numberToRadians(lat2-lat1);
          var distLon = this.numberToRadians(lon2-lon1);

          var a = Math.sin(distLat/2) * Math.sin(distLat/2) +
              Math.cos(lat1) * Math.cos(lat2) *
              Math.sin(distLon/2) * Math.sin(distLon/2);
          var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

          var computedDistance =  parseFloat((R * c)/1000).toFixed(2);
          if (computedDistance.substr(computedDistance.length - 3, computedDistance.length) == .00)
              computedDistance = computedDistance.substr(0, computedDistance.length - 3);
          else if (computedDistance.substr(computedDistance.length - 1, computedDistance.length) == 0)
              computedDistance = computedDistance.substr(0, computedDistance.length - 1);
//          console.log("distance = ", computedDistance);


          return computedDistance + "km";

      },

      numberToRadians : function (n) {
          return n * (Math.PI/180)
      },
//        _f:function(x){
//          console.log(x);
//          return x;
//        },

        _sort : function (a, b) {
            var distA = this.distance(a.latitude, a.longitude);
            var distB = this.distance(b.latitude, b.longitude);

            if (distA === distB) return 0;
            return distA < distB ? -1 : 1;
        }
    });

    function linkToProfile(el)
    {
        el.addEventListener('transitionend', function(e)
        {
            location.href = "/profile/{{item._id}}";
        })
    }

  </script>
</dom-module>
